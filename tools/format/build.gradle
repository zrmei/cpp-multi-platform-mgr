def isWindows() {
    return org.gradle.internal.os.OperatingSystem.current().isWindows()
}

tasks.register("format-code") {
    group = "format"
    description = "auto format codes under src"

    Properties localProperties = getCombinedProperties(["local", "format"])

    def project_dirname = localProperties.getProperty("def.PROJECT_DIRNAME", ".")

    doLast {       
        if (isWindows()) {
            try {
                exec {
                    ExecSpec execSpec ->
                        executable 'cmd.exe'
                        args "/c", ".\\format.bat", project_dirname
                }

                println "format all success"
            } catch (Exception e) {
                println "Please call zrmei"
            }
        } else {
            try {
                exec {
                    ExecSpec execSpec ->
                        executable 'bash'
                        args "./format.sh", project_dirname
                }

                println "format all success"
            } catch (Exception e) {
                println "Please call zrmei"
            }
         }

    }
}